views:
- title: Urban
  sections:
  - type: grid
    cards:
    - type: custom:energy-period-selector-plus
      card_background: true
      today_button: true
      prev_next_buttons: false
      compare_button_type: ""
      today_button_type: text
      period_buttons:
      - day
      - week
      - month
      - year
      - custom
  - type: grid
    cards:
    - type: custom:energy-flow-card-plus
      entities:
        battery:
          entity:
            production: sensor.batterie_virtuelle_entree_horaire
            consumption: sensor.batterie_virtuelle_sortie_horaire
          state_of_charge: input_number.batterie_virtuelle_stock
          state_of_charge_unit: kwh
          use_metadata: true
        grid:
          entity:
            consumption: sensor.energie_importee_enedis
          use_metadata: false
        home:
          entity: sensor.energie_totale_consommee
          subtract_individual: false
          use_metadata: false
          override_state: false
        solar:
          entity: sensor.envoy_energie_produite
      clickable_entities: true
      display_zero_lines: true
      use_new_flow_rate_model: true
      energy_date_selection: true
      wh_decimals: 1
      kwh_decimals: 0
      min_flow_rate: 1
      max_flow_rate: 6
      max_expected_energy: 2000
      min_expected_energy: 10
      wh_kwh_threshold: 1000
      title: Energy Flow Card
    - type: custom:apexcharts-card
      graph_span: 3d
      span:
        end: minute
      header:
        show: true
        title: Batterie Virtuelle
        show_states: true
        colorize_states: true
      series:
      - entity: input_number.batterie_virtuelle_stock
        yaxis_id: first
        name: Stock batterie
        type: line
        group_by:
          duration: 0.5h
          func: last
        stroke_width: 3
      - entity: input_number.batterie_virtuelle_pointage
        yaxis_id: first
        name: Pointage manuel
        type: line
        stroke_width: 3
        color: "#995000"
        show:
          in_chart: false
      yaxis:
      - id: first
        decimals: 1
        apex_config:
          tickAmount: 4
    - type: custom:apexcharts-card
      graph_span: 3d
      span:
        end: minute
      header:
        show: true
        title: Bilan energie réseau
        show_states: true
        colorize_states: true
      apex_config:
        chart:
          type: line
      series:
      - entity: sensor.energie_restituee_au_reseau
        yaxis_id: first
        type: line
        color: green
        group_by:
          duration: 0.5d
          func: diff
        name: Variation quotidienne
      yaxis:
      - id: first
        decimals: 0
        apex_config:
          tickAmount: 4
    column_span: 3
  - type: grid
    panel: true
    cards: []
  - type: grid
    cards: []
  - type: grid
    cards:
    - type: heading
      heading_style: title
    - type: custom:apexcharts-card
      graph_span: 3day
      span:
        end: minute
      header:
        show: true
        title: Batterie Virtuelle - Flux Horaire
        show_states: true
        colorize_states: true
      apex_config:
        chart:
          type: area
        stroke:
          curve: smooth
      series:
      - entity: input_number.energie_battery_in_hourly
        yaxis_id: first
        name: Entrée Batterie (IN)
        type: line
        color: "#00C853"
        stroke_width: 3
        group_by:
          duration: 1h
          func: median
      - entity: input_number.energie_battery_out_hourly
        name: Sortie Batterie (OUT)
        yaxis_id: first
        type: line
        color: "#D50000"
        stroke_width: 3
        group_by:
          duration: 1h
          func: median
      - entity: sensor.energie_restituee_au_reseau_hourly
        name: Bilan energie
        yaxis_id: second
        type: line
        color: yellow
        stroke_width: 1
        group_by:
          duration: 1h
          func: median
      yaxis:
      - id: first
        decimals: 1
        apex_config:
          tickAmount: 4
      - id: second
        opposite: true
        decimals: 1
        apex_config:
          tickAmount: 4
    - type: custom:vertical-stack-in-card
      title: Batterie Virtuelle (kWh)
      cards:
      - type: custom:numberbox-card
        entity: input_number.batterie_virtuelle_pointage
        name: "Pointage manuel "
        icon: mdi:target
        min: 0
        max: 100
        step: 0.1
        unit: kWh
        style: |
          ha-card {
            margin-bottom: 8px;
          }
        secondary_info: à date de facture
      - type: custom:numberbox-card
        entity: input_number.batterie_virtuelle_stock
        name: Stock calculé
        icon: mdi:battery
        min: -100
        max: 200
        step: 0.1
        unit: kWh
        border: false
      grid_options:
        columns: 12
        rows: 5
    - type: entities
      entities:
      - entity: sensor.energie_restituee_au_reseau_hourly
        name: Variation horaire
      - entity: sensor.batterie_virtuelle_entree_horaire
        secondary_info: none
        name: "Batt in pour dashboard energy "
      - entity: sensor.batterie_virtuelle_sortie_horaire
        name: Batt out pour dashboard energy
      title: Index horaire et sensor horaire
    column_span: 3
  cards: []
  type: sections
  max_columns: 3
  dense_section_placement: true
